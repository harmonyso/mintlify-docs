---
title: 'Microsoft Entra ID'
description: 'Sync Azure AD users and automate Microsoft 365 access management across your organization'
icon: '/images/integrations/microsoft-entra.svg'
---

## About Microsoft Entra ID

Microsoft Entra ID (formerly Azure Active Directory) is Microsoft's cloud-based identity and access management service. Connecting Entra ID to Harmony enables automated user provisioning, intelligent license management, and seamless access control across your Microsoft 365 ecosystem and integrated applications.

## What the Microsoft Entra ID integration enables

| Capability               | Description                                                                                |
| ------------------------ | ------------------------------------------------------------------------------------------ |
| User Provisioning        | Automate user lifecycle management across Microsoft 365 services                           |
| License Management       | Track and optimize Microsoft 365 licenses to reduce costs                                  |
| Group Management         | Sync security and distribution groups for access control                                   |
| Application Discovery    | Identify all enterprise applications and their assignments                                 |
| Conditional Access       | Enforce intelligent access policies based on context                                       |
| Automation Workflows     | Build custom workflows using Microsoft Graph API                                           |

Anything defined in the [Microsoft Graph API](https://learn.microsoft.com/en-us/graph/api/overview) can be accessed through Harmony workflows.

***

## Prerequisites

Before connecting Microsoft Entra ID to Harmony, ensure you have:

1. **Microsoft 365 Global Administrator access**
2. **Azure AD Premium licenses** (for advanced features like conditional access)
3. **Permissions to register applications** in Azure AD
4. **A Harmony account** with admin privileges

<Note>
  Global Administrator or Privileged Role Administrator role is required to grant admin consent for application permissions.
</Note>

***

## Azure AD Configuration

### Step 1: Register Harmony Application

<Steps>
  <Step title="Navigate to App Registrations">
    1. Sign in to the [Azure Portal](https://portal.azure.com)
    2. Navigate to **Azure Active Directory → App registrations**
    3. Click **+ New registration**
  </Step>

  <Step title="Configure Registration">
    Fill in the application details:

    | Field                  | Value                                    |
    | ---------------------- | ---------------------------------------- |
    | **Name**               | `Harmony Integration`                    |
    | **Supported account types** | Accounts in this organizational directory only |
    | **Redirect URI**       | Leave blank for now                      |

    Click **Register**
  </Step>

  <Step title="Note Application ID">
    After registration, copy the following values:
    - **Application (client) ID**
    - **Directory (tenant) ID**

    <Tip>
      You'll need these values when configuring Harmony.
    </Tip>
  </Step>
</Steps>

### Step 2: Create Client Secret

<Steps>
  <Step title="Generate Secret">
    1. In your app registration, navigate to **Certificates & secrets**
    2. Click **+ New client secret**
    3. Add description: `Harmony Integration Secret`
    4. Select expiration: **24 months** (recommended)
    5. Click **Add**
  </Step>

  <Step title="Copy Secret Value">
    **Important**: Copy the secret **Value** immediately—it won't be shown again.

    <Warning>
      Save the client secret securely. If lost, you'll need to generate a new secret and update Harmony.
    </Warning>
  </Step>
</Steps>

### Step 3: Configure API Permissions

<Steps>
  <Step title="Add Permissions">
    1. Navigate to **API permissions** in your app registration
    2. Click **+ Add a permission**
    3. Select **Microsoft Graph**
    4. Choose **Application permissions** (not Delegated)
  </Step>

  <Step title="Select Required Permissions">
    Add the following Microsoft Graph permissions:

    **User Management:**
    - `User.Read.All` - Read all users' profiles
    - `User.ReadWrite.All` - Manage user accounts (for provisioning)

    **Group Management:**
    - `Group.Read.All` - Read all groups
    - `GroupMember.Read.All` - Read group memberships

    **Directory Management:**
    - `Directory.Read.All` - Read directory data
    - `Organization.Read.All` - Read organization information

    **Application Management:**
    - `Application.Read.All` - Read applications and service principals

    **License Management (Optional):**
    - `Organization.Read.All` - Read license assignments

    <Tip>
      Start with read-only permissions (`*.Read.All`) for testing, then add write permissions when enabling provisioning workflows.
    </Tip>
  </Step>

  <Step title="Grant Admin Consent">
    1. Click **Grant admin consent for [Your Organization]**
    2. Click **Yes** to confirm
    3. Verify all permissions show **Granted for [Your Organization]** status

    <Warning>
      Admin consent is required for application permissions. Without it, Harmony cannot access your directory.
    </Warning>
  </Step>
</Steps>

***

## Harmony Configuration

<Steps>
  <Step title="Navigate to Integrations">
    1. Log into your Harmony dashboard
    2. Navigate to **Settings → Integrations**
    3. Find **Microsoft Entra ID** under **Identity & Access Management**
    4. Click **Connect**
  </Step>

  <Step title="Enter Configuration">
    Fill in the following fields:

    | Field           | Description                          | Example                      |
    | --------------- | ------------------------------------ | ---------------------------- |
    | **Tenant ID**   | Your Azure AD tenant (directory) ID  | `12345678-1234-1234-1234-123456789012` |
    | **Client ID**   | Application (client) ID              | `87654321-4321-4321-4321-210987654321` |
    | **Client Secret** | The client secret value you generated | `your~secret~value...`     |

    <Note>
      Use the **Value** of the client secret, not the **Secret ID**.
    </Note>
  </Step>

  <Step title="Test Connection">
    1. Click **Connect**
    2. Harmony will authenticate and fetch directory information
    3. If successful, you'll see a confirmation message
    4. User and group sync will begin automatically
  </Step>
</Steps>

***

## What Harmony Syncs from Entra ID

Once connected, Harmony automatically syncs:

### Users

- User profiles (name, email, job title)
- User Principal Name (UPN)
- User status (enabled, disabled)
- Department and office location
- Manager relationships
- Member/Guest type
- Last sign-in activity
- Assigned licenses

### Groups

- Security groups
- Microsoft 365 groups
- Distribution lists
- Group memberships
- Group owners
- Dynamic group rules

### Applications

- Enterprise applications
- App registrations
- Service principals
- User and group assignments
- OAuth permissions

### Licenses

- Available license SKUs
- License assignments per user
- Subscription status
- Service plan details

<Tip>
  Harmony syncs data every 24 hours by default. Critical changes (user creation, deletion) trigger immediate incremental sync.
</Tip>

***

## Use Cases

### Automated User Lifecycle

**Onboarding:**
- Create Entra ID account for new hire
- Assign licenses based on department
- Add to appropriate security groups
- Provision access to applications
- Set up MFA and security defaults

**Offboarding:**
- Disable account immediately
- Revoke all licenses
- Remove from all groups
- Sign out all active sessions
- Schedule account deletion after 30 days

### License Optimization

Identify cost-saving opportunities:
- **Unused E5 licenses**: Users with E5 who don't use premium features
- **Inactive users**: Licensed users who haven't signed in for 60+ days
- **Guest users**: External users consuming licenses unnecessarily
- **Service accounts**: Accounts with licenses that don't need them

**Typical savings**: 10-25% reduction in Microsoft 365 costs

### Conditional Access Automation

Implement intelligent access policies:
- Require MFA for admin accounts
- Block legacy authentication
- Enforce compliant devices for access
- Geo-location based restrictions
- Risk-based conditional access

### Group-Based Access Management

- **Auto-assignment**: Add users to groups based on department, location, or role
- **Access reviews**: Periodic audits of group memberships
- **Just-in-time access**: Temporary group membership with automatic removal
- **Privileged access**: Time-bound admin role assignments

***

## Troubleshooting

### Connection fails with insufficient permissions

**Solutions:**
1. Verify all required API permissions are added
2. Ensure admin consent was granted (check green checkmarks)
3. Wait 5 minutes after granting consent for changes to propagate
4. Try regenerating the client secret

### User sync incomplete

**Solutions:**
1. Check if `User.Read.All` permission is granted
2. Verify users are not hidden in directory
3. For large directories (10,000+ users), allow extra sync time
4. Review sync logs for specific errors

### Cannot provision new users

**Solutions:**
1. Ensure `User.ReadWrite.All` permission is granted
2. Verify you have available licenses to assign
3. Check that domain is verified in Azure AD
4. Confirm user email format matches verified domains

### License assignments failing

**Solutions:**
1. Verify user's usage location is set
2. Ensure licenses are available (not all consumed)
3. Check license dependencies (some require others)
4. Confirm service plans are available in user's region

***

## Best Practices

<AccordionGroup>
  <Accordion title="Use Service Principal Authentication">
    Application permissions (service principal) are more secure than delegated permissions:
    - No user context required
    - Credentials don't expire with user password changes
    - Better audit trails
    - Least privilege model
  </Accordion>

  <Accordion title="Rotate Secrets Regularly">
    Implement a secret rotation schedule:
    - Set secret expiration to 12-24 months
    - Set reminders 30 days before expiration
    - Generate new secret before old one expires
    - Update Harmony with new secret
    - Delete old secret only after confirming new one works
  </Accordion>

  <Accordion title="Monitor API Throttling">
    Microsoft Graph has rate limits:
    - 2,000 requests per second per tenant
    - Monitor for 429 (Too Many Requests) responses
    - Implement exponential backoff for retries
    - For large operations, spread them over time
  </Accordion>

  <Accordion title="Leverage Dynamic Groups">
    Use dynamic groups for automated membership:
    - Auto-add users based on department attribute
    - Include users from specific locations
    - Filter by job title or employee type
    - Reduces manual group management overhead
  </Accordion>

  <Accordion title="Enable Security Defaults">
    Enforce baseline security:
    - Require MFA for all users
    - Protect privileged accounts
    - Block legacy authentication
    - Security defaults provide immediate protection
  </Accordion>
</AccordionGroup>

***

## Security Considerations

<Warning>
  **Least Privilege**: Only grant permissions needed for your use case. Start with read-only and add write permissions as needed.
</Warning>

**Security best practices:**

- Use separate app registrations for different environments (dev, prod)
- Enable certificate-based authentication for production
- Monitor sign-in logs for the service principal
- Set up alerts for unusual API activity
- Store client secrets in Azure Key Vault (for production)
- Regularly review and audit permissions

***

Need help? Contact **[support@harmony.io](mailto:support@harmony.io)** for assistance with your Microsoft Entra ID integration.

***

## Data & Privacy

For information about how Harmony handles your data, see our [Privacy Policy](https://harmony.io/privacy).

**Key privacy principles:**
- Azure AD credentials are encrypted at rest and in transit
- Only directory data necessary for IT operations is accessed
- No personal emails or private conversations are read
- User activity data used only for license optimization
- Integration can be revoked at any time from Azure Portal or Harmony
